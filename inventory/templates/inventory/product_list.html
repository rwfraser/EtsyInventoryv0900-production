{% extends 'inventory/base.html' %}

{% block title %}Products - Etsy Inventory{% endblock %}

{% block content %}
<h2>Product Inventory</h2>

<div class="search-box">
    <form method="get">
        <input type="text" name="search" placeholder="Search products..." value="{{ request.GET.search }}">
        <select name="status">
            <option value="">All Status</option>
            {% for value, label in status_choices %}
                <option value="{{ value }}" {% if request.GET.status == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <select name="category">
            <option value="">All Categories</option>
            {% for category in categories %}
                <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>{{ category.name }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-primary">Filter</button>
    </form>
</div>

{% if products %}
<table>
    <thead>
        <tr>
            <th>SKU</th>
            <th>Title</th>
            <th>Category</th>
            <th>Status</th>
            <th>Available</th>
            <th>Reserved</th>
            <th>Price</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for product in products %}
        <tr>
            <td><strong>{{ product.sku }}</strong></td>
            <td>{{ product.title }}</td>
            <td>{{ product.category|default:"â€”" }}</td>
            <td>
                {% if product.status == 'active' %}
                    <span class="badge badge-success">Active</span>
                {% elif product.status == 'draft' %}
                    <span class="badge badge-secondary">Draft</span>
                {% elif product.status == 'sold_out' %}
                    <span class="badge badge-danger">Sold Out</span>
                {% else %}
                    <span class="badge badge-warning">{{ product.get_status_display }}</span>
                {% endif %}
            </td>
            <td>
                {% if product.is_low_stock %}
                    <span class="badge badge-danger">{{ product.available_stock }}</span>
                {% else %}
                    {{ product.available_stock }}
                {% endif %}
            </td>
            <td>{{ product.quantity_reserved }}</td>
            <td>${{ product.sale_price }}</td>
            <td>
                <a href="{% url 'inventory:product_detail' product.pk %}" class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;">View</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No products found. <a href="{% url 'admin:inventory_product_add' %}">Add your first product</a></p>
{% endif %}

{% endblock %}
